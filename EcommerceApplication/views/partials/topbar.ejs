<div class="navbar topbar-contrast shadow-sm">
  <div class="container-fluid d-flex justify-content-between align-items-center py-2">
    <a class="navbar-brand fw-bold mb-0" href="/home">Ecomme</a>
    <div class="d-flex align-items-center gap-2">
      <% if (user) { %>
        <% if (typeof acct !== "undefined" && acct) { %>
          <span class="navbar-text account-pill mb-0">
            Account (<%= (user && user.role) ? user.role : 'Customer' %>): <%= acct %>
          </span>
        <% } %>
        <form action="/logout" method="POST" class="m-0">
          <button class="btn btn-dark nav-btn" type="submit">Logout</button>
        </form>
      <% } else { %>
        <a class="btn btn-outline-dark nav-btn" href="/login">Login</a>
      <% } %>
    </div>
  </div>
</div>

<style>
  .topbar-contrast {
    background: #f8f9fa;
    color: #0f1115;
  }
  .topbar-contrast .navbar-brand,
  .topbar-contrast .navbar-brand:hover,
  .topbar-contrast .navbar-brand:focus {
    color: #000 !important;
    font-weight: 800;
    letter-spacing: 0.5px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.08);
  }
  .topbar-contrast .nav-btn {
    border-radius: 999px;
  }
</style>

<script>
  (() => {
    // Per-tab id stored in sessionStorage
    const existing = sessionStorage.getItem('tabId');
    const tabId = existing || crypto.randomUUID();
    sessionStorage.setItem('tabId', tabId);

    // Append ?tab=... to internal links and form actions; add hidden input for POSTs
    const sameOrigin = (url) => {
      try { const u = new URL(url, window.location.origin); return u.origin === window.location.origin; }
      catch { return false; }
    };

    document.querySelectorAll('a[href^="/"]').forEach(a => {
      if (!sameOrigin(a.href)) return;
      const url = new URL(a.href, window.location.origin);
      if (!url.searchParams.has('tab')) {
        url.searchParams.set('tab', tabId);
        a.href = url.pathname + url.search + url.hash;
      }
    });

    document.querySelectorAll('form[action^="/"]').forEach(form => {
      const url = new URL(form.action, window.location.origin);
      if (!url.searchParams.has('tab')) {
        url.searchParams.set('tab', tabId);
        form.action = url.pathname + url.search + url.hash;
      }
      if (!form.querySelector('input[name="tab"]')) {
        const hidden = document.createElement('input');
        hidden.type = 'hidden';
        hidden.name = 'tab';
        hidden.value = tabId;
        form.appendChild(hidden);
      }
    });
  })();
</script>
